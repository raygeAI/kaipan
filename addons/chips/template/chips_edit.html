{template 'common/header-project'}

<div class="main">
    <form action="" method="post"  class="form-horizontal" role="form" enctype="multipart/form-data" id="form1">
        <input class="hidden" value="{$chips['id']}">
    <div class="panel panel-info" >

        <div class="panel-heading"><h4 class="panel-title">认筹单信息</h4></div>
        <div class="panel-body">
            <h4>用户基础信息</h4>
            <div class="form-group" >
                <label class="col-sm-2 control-label">客户名称</label>
                <div class="col-sm-3">
                    <input readonly="true" type="text" name="user[CstName]" value="{$user_info['CstName']}" class="form-control">
                </div>
                <label class="col-sm-1 control-label">性别</label>
                <div class="col-sm-2"  >
                    <label class="radio-inline" >
                        <input disabled type="radio" name="user[Gender]" value="男" {if '男'==$user_info['Gender']}checked="checked"{/if}/>男
                    </label>
                    <label class="radio-inline">
                        <input disabled type="radio" name="user[Gender]" value="女" {if '女'==$user_info['Gender']}checked="checked"{/if}/> 女
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">证件类型</label>
                <div class="col-sm-2">
                    <select  name="user[CardType]" class="form-control " disabled>
                        {loop $cardTypes $type}
                        <option value="{$type}" {if $type==$user_info['CardType']}selected {/if}>{$type}</option>
                        {/loop}
                    </select>
                </div>
                <label class="col-sm-2 control-label">证件号码</label>
                <div class="col-sm-4">
                    <input readonly="true" type="text" name="user[CardID]" class="form-control"  value="{$user_info['CardID']}" placeholder="请输入身份证号码">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">通讯地址</label>
                <div class="col-sm-8">
                    <div class="input-append"><input type="text" name="user[Address]" value="{$user_info['Address']}"  class="form-control" /></div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">手机号码</label>
                <div class="col-sm-3">
                    <input type="text" name="user[MobileTel]" class="form-control" value="{$user_info['MobileTel']}" placeholder="请输入手机号码">
                </div>
                <label class="col-sm-2 control-label">家庭电话</label>
                <div class="col-sm-3">
                    <input type="text" name="user[HomeTel]" class="form-control" value="{$user_info['HomeTel']}" placeholder="请输入家庭电话号码">
                </div>
                <!--label class="col-sm-2 control-label">工作电话</label>
                <div class="col-sm-2">
                    <input type="text" name="user[OfficeTel]" class="form-control"  value="{$user_info['OfficeTel']}" placeholder="请输入工作电话号码">
                </div-->
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">国籍</label>
                <div class="col-sm-3">
                    <select name="user[Country]" class="form-control">
                        <option value="中国" {if $user_info['Country']=="中国"}selected{/if}>中国</option>
                        <option value="其他" {if $user_info['Country']=="其他"}selected{/if}>其他</option>
                    </select>
                </div>
                <label class="col-sm-2 control-label">邮政编码</label>
                <div class="col-sm-3">
                    <input type="text" name="user[PostCode]" class="form-control" value="{$user_info['PostCode']}">
                </div>
            </div>
            <h4>认筹相关信息</h4>
            <div class="form-group">
                <label class="col-sm-2 control-label">意向产品</label>
                <div class="col-sm-3">
                    <select name="chips[product]" class="form-control">
                        {loop $products $i}
                        <option value="{$i['name']}"{if $chips['product']==$i['name']} selected {/if}>{$i['name']}</option>
                        {/loop}
                    </select>
                </div>
                <label class="col-sm-2 control-label">意向户型</label>
                <div class="col-sm-3">
                    <select name="chips[housetype]" class="form-control">
                        {loop $housetype $i}
                        <option value="{$i['name']}"{if $chips['housetype']==$i['name']} selected {/if}>{$i['name']}</option>
                        {/loop}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">具体意向</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <input type="text" class="form-control" name="chips[intendroom]" value="{$chips['intendroom']}" id="intendroom" readonly="readonly">
                    <span class="input-group-btn">
                        <a class="btn btn-default" id="btn_room">选择</a>
                    </span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">本地户口</label>
                <div class="col-sm-3">
                    <label class="radio-inline">
                        <input type="radio" name="chips[local]" value="1" {if $chips['local']==1} checked {/if}/>是
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="chips[local]" value="0" {if $chips['local']==0} checked {/if}/> 否
                    </label>
                </div>
                <label class="col-sm-2 control-label">已有房</label>
                <div class="col-sm-3">
                    <div class="input-group">
                        <input class="form-control" type="number" placeholder="请输入套数" name="chips[housenum]" value="{$chips['housenum']}">
                        <div class="input-group-addon">套</div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">代理公司</label>
                <div class="col-sm-3">
                    <select name="chips[agency]" class="form-control ">
                        {loop $agency $type}
                        <option value="{$type['name']}" {if $chips['agency']==$type['name']} selected {/if}>{$type['name']}</option>
                        {/loop}
                    </select>
                </div>
                <label class="col-sm-2 control-label">业务员</label>
                <div class="col-sm-3">
                    <select name="chips[sales]" class="form-control">
                        {loop $salesman $k $type}
                        <!--option value="{$type['UserName']}"{if $chips['salesman']==$type['UserName']} selected {/if}>{$type['StationName']}-{$type['UserName']}</option-->
                        <option value="{$k}"{if $chips['salesman']==$type['UserName']} selected {/if}>{$type['StationName']}-{$type['UserName']}</option>
                        {/loop}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">辅助代理</label>
                <div class="col-sm-3">
                    <select name="chips[agencychild]" class="form-control">
                        <option value="">无</option>
                        {loop $agency $type}
                        <option value="{$type['name']}" {if $chips['agencychild']==$type['name']} selected {/if}>{$type['name']}</option>
                        {/loop}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">备注</label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" name="chips[remark]"  value="{$chips['remark']}">
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="btn-group btn-group-justified">
                <div class="btn-group">
                    <input type="hidden" name="token" value="{$_W['token']}" />
                    <button class="btn  btn-success " type="submit" name="submit" value="submit"><i class="fa fa-check"></i>保存</button>
                </div>
                <div class="btn-group">
                    <a class="btn  btn-warning " href="{php echo $this->createWebUrl('chips');}"><i class="fa fa-rebel"></i>取消 </a>
                </div>
            </div>
        </div>
    </div>
    </form>
</div>
<script>
    var url="{php echo $this->createWebUrl('roomset');}";
    require(['bootstrap', 'util'], function ($, u) {
    $('#btn_room').on('click', function (){
        var uids=$('#intendroom').val();
        var footer =
                '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>' +
                        '<button type="button" class="btn btn-primary">确认</button>';
        var dialog = u.dialog('具体意向选择（最多选3个）', [url+'&callback=aMember'+'&uids=' + uids], footer);
        dialog.modal('show');
        dialog.find('.btn.btn-primary').click(function(){
            var _selroom=$('#sel_room').val();
            $('#intendroom').val(_selroom);
            dialog.modal('hide');
        });
        window.aMember = {
            pIndex : 1,
            query : function() {
                var data = {
                    keyword: $('#keyword').val(),
                    page: aMember.pIndex,
                    callback:'aMember',
                    uids: $('#sel_room').val()
                };
                $.post(url, data, function(dat){
                    dialog.find('.modal-body').html(dat);
                });
            }
        };

        window.p = function(url, p, state) {
            aMember.pIndex = p;
            window.aMember.query();
        }
        window.selroom=function(obj){
            var _selroom=$('#sel_room').val();
            var _rooms=[];
            if(_selroom!='')
            {_rooms=_selroom.split(',');}
            var code=  $(obj).closest('tr').find('.code').text();
            var index=_rooms.indexOf(code);
            if(index<0){
                if(_rooms.length<3)
                {_rooms.push(code);}

            }else {
                _rooms.remove(code);
            }
            $('#sel_room').val(_rooms.join(','));
        }

    });
    });
</script>
{template 'common/footer'}